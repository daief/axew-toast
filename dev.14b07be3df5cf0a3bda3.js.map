{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/constant.ts","webpack:///./src/helper.ts","webpack:///./src/Queue.ts","webpack:///./src/index.ts","webpack:///./dev/index.ts","webpack:///./src/style/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ANIMATE_DURATION","PREFIX","CONTAINER_CLASS_NAME","WRAP_CLASS_NAME","CONTENT_CLASS_NAME","HIDE_CLASS_NAME","TEXT_CLASS_NAME","LOADING_CLASS_NAME","MODAL_CLASS_NAME","MAX_TIMEOUT","CANCELED_MSG","modalCtrl","ModalCtrl","this","modalCount","isBrowser","modalDiv","createDiv","showModal","style","display","hideModal","noop","window","className","el","document","createElement","setAttribute","cls","arr","_i","arguments","length","filter","_","join","createToastElAndShow","options","text","loading","onClick","isModal","container","content","wrap","addEventListener","innerHTML","appendChild","body","removeEl","rootEl","opts","isCalled","remove","removeChild","setTimeout","getNoopResult","promise","Promise","resolve","cancel","queueCtrl","Queue","queue","lock","push","item","front","shift","findIndex","splice","execute","onExcute","_a","sent","toast","argTimeout","reject","timer","elements","__assign","timeout","freeze","guardOptions","r1","r2","queueResolve_1","queueReject_1","queuePromise_1","then","catch","clearTimeout","queueItem_1","error","Error","queueToast","__webpack_exports__","_src__WEBPACK_IMPORTED_MODULE_0__","_src_style__WEBPACK_IMPORTED_MODULE_1__","axewToast","select","querySelector","$toast","$cancel","$queue","getRadioValue","getInputValue","isQueue","first","forEach"],"mappings":"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","file":"dev.14b07be3df5cf0a3bda3.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"./\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","/*\n * @Author: daief\n * @LastEditors: daief\n * @Date: 2019-12-17 16:25:23\n * @LastEditTime: 2019-12-18 09:43:10\n * @Description:\n */\nexport const ANIMATE_DURATION = 500;\nexport const PREFIX = 'axew-toast';\nexport const CONTAINER_CLASS_NAME = PREFIX + '-container';\nexport const WRAP_CLASS_NAME = PREFIX + '-wrap';\nexport const CONTENT_CLASS_NAME = PREFIX + '-content';\nexport const HIDE_CLASS_NAME = PREFIX + '-hide';\nexport const TEXT_CLASS_NAME = PREFIX + '-text';\nexport const LOADING_CLASS_NAME = PREFIX + '-loading';\nexport const MODAL_CLASS_NAME = PREFIX + '-modal';\n// 2^31 - 1\nexport const MAX_TIMEOUT = 2147483647;\nexport const CANCELED_MSG = `${PREFIX} - canceled.`;\n","/*\n * @Author: daief\n * @LastEditors: daief\n * @Date: 2019-12-17 16:18:36\n * @LastEditTime: 2019-12-18 09:35:14\n * @Description:\n */\nimport { IOptions, IObjectOptions } from './interface';\nimport {\n  CONTAINER_CLASS_NAME,\n  CONTENT_CLASS_NAME,\n  WRAP_CLASS_NAME,\n  LOADING_CLASS_NAME,\n  TEXT_CLASS_NAME,\n  HIDE_CLASS_NAME,\n  ANIMATE_DURATION,\n  MODAL_CLASS_NAME,\n} from './constant';\n// import { modalCtrl } from './ModalCtrl';\n\n// 先将 ModalCtrl 移动到此处，以避免循环引用的问题\nexport class ModalCtrl {\n  modalDiv!: HTMLDivElement;\n\n  /**\n   * modal show times\n   */\n  modalCount = 0;\n\n  constructor() {\n    if (isBrowser()) {\n      this.modalDiv = createDiv(MODAL_CLASS_NAME);\n    }\n  }\n\n  showModal() {\n    if (this.modalDiv) {\n      this.modalDiv.style.display = 'block';\n      this.modalCount += 1;\n    }\n  }\n\n  hideModal() {\n    this.modalCount -= 1;\n    if (this.modalDiv && this.modalCount <= 0) {\n      this.modalDiv.style.display = 'none';\n    }\n  }\n}\n\nexport const modalCtrl = new ModalCtrl();\n\nexport function noop() {}\n\nexport function isBrowser() {\n  return typeof window !== 'undefined';\n}\n\nexport function guardOptions(\n  opts: IOptions,\n  argTimeout?: number | true,\n): Readonly<Required<IObjectOptions>> {\n  if (typeof opts === 'string') {\n    opts = { text: opts };\n  }\n  if (typeof opts === 'boolean') {\n    opts = { loading: opts };\n  }\n\n  const options: Required<IObjectOptions> = {\n    text: '',\n    className: '',\n    loading: false,\n    isModal: false,\n    timeout: argTimeout || 2500,\n    onClick: noop,\n    queue: false,\n    ...opts,\n  };\n\n  if (typeof options.onClick !== 'function') {\n    options.onClick = noop;\n  }\n\n  return Object.freeze(options);\n}\n\nexport function createDiv(className: string): HTMLDivElement {\n  const el = document.createElement('div');\n  el.setAttribute('class', className);\n  return el;\n}\n\nexport function cls(...arr: string[]) {\n  return arr.filter(_ => !!_).join(' ');\n}\n\nexport function createToastElAndShow(options: Required<IObjectOptions>) {\n  const { text, className, loading, onClick, isModal } = options;\n  const container = createDiv(cls(CONTAINER_CLASS_NAME, className));\n  const content = createDiv(CONTENT_CLASS_NAME);\n  const wrap = createDiv(WRAP_CLASS_NAME);\n\n  if (onClick !== noop) {\n    wrap.addEventListener('click', onClick, onClick.options);\n  }\n\n  wrap.innerHTML = loading\n    ? `<i class=\"${LOADING_CLASS_NAME}\"></i>`\n    : `<p class=\"${TEXT_CLASS_NAME}\">${text}</p>`;\n\n  content.appendChild(wrap);\n  container.appendChild(content);\n\n  if (isModal) {\n    document.body.appendChild(modalCtrl.modalDiv);\n    modalCtrl.showModal();\n  }\n  document.body.appendChild(container);\n\n  return {\n    container,\n    content,\n    wrap,\n  };\n}\n\n/**\n * 监听动画，动画结束时移除元素\n * @param el 动画目标元素\n * @param rootEl 根元素\n */\nexport function removeEl(\n  el: HTMLElement,\n  rootEl: HTMLElement,\n  opts: Exclude<IOptions, boolean | string>,\n) {\n  let isCalled = false;\n  const remove = () => {\n    if (isCalled) {\n      return;\n    }\n    isCalled = true;\n    document.body.removeChild(rootEl);\n    if (opts.isModal) {\n      modalCtrl.hideModal();\n    }\n  };\n  el.setAttribute('class', cls(CONTENT_CLASS_NAME, HIDE_CLASS_NAME));\n  el.addEventListener('animationend', remove);\n  // force remove\n  // 以防 animationend 未触发\n  setTimeout(remove, ANIMATE_DURATION);\n}\n\nexport const getNoopResult = () => ({\n  promise: Promise.resolve(),\n  cancel: () => void 0,\n});\n","/*\n * @Author: daief\n * @LastEditors: daief\n * @Date: 2019-12-17 17:29:27\n * @LastEditTime: 2019-12-17 20:16:28\n * @Description:\n */\nimport { IQueueItem } from './interface';\n\nexport class Queue {\n  private queue: IQueueItem[] = [];\n  private lock = false;\n\n  push(item: IQueueItem) {\n    this.queue.push(item);\n  }\n\n  front(): IQueueItem | void {\n    return this.queue.shift();\n  }\n\n  remove(item: IQueueItem): number {\n    const i = this.queue.findIndex(_ => _ === item);\n    if (i > -1) {\n      this.queue.splice(i, 1);\n    }\n    return i;\n  }\n\n  async execute() {\n    if (this.lock) {\n      return;\n    }\n\n    this.lock = true;\n    let item: IQueueItem | void;\n    while ((item = this.front())) {\n      const { onExcute } = item;\n      await onExcute();\n    }\n    this.lock = false;\n  }\n}\n\nexport const queueCtrl = new Queue();\n","/*\n * @Author: daief\n * @LastEditors  : daief\n * @Date: 2019-12-17 17:06:54\n * @LastEditTime : 2020-01-17 14:48:06\n * @Description:\n */\nimport { IOptions, IToastResult } from './interface';\nimport {\n  guardOptions,\n  createToastElAndShow,\n  removeEl,\n  isBrowser,\n  getNoopResult,\n} from './helper';\nimport { MAX_TIMEOUT, CANCELED_MSG } from './constant';\nimport { queueCtrl } from './Queue';\n\nexport default function toast(\n  opts: IOptions,\n  argTimeout?: number | true,\n): IToastResult {\n  // SSR safe\n  // TODO maybe keep same login on server env\n  if (!isBrowser()) {\n    return getNoopResult();\n  }\n  const options = guardOptions(opts, argTimeout);\n  const { timeout, queue } = options;\n\n  let resolve: any;\n  let reject: any;\n  let timer: any;\n  let elements: ReturnType<typeof createToastElAndShow>;\n  let promise = new Promise<void>((r1, r2) => {\n    resolve = r1;\n    reject = r2;\n  });\n\n  if (queue) {\n    let queueResolve: any;\n    let queueReject: any;\n    const queuePromise = new Promise((r1, r2) => {\n      queueResolve = r1;\n      queueReject = r2;\n    })\n      .then(() => {\n        // 队列内 promsie 结束后，改变最外层 promise 状态\n        if (elements) {\n          removeEl(elements.content, elements.container, options);\n        }\n        resolve();\n      })\n      .catch(() => {\n        // 被取消\n        clearTimeout(timer);\n        if (elements) {\n          removeEl(elements.content, elements.container, options);\n        }\n      });\n\n    const queueItem = {\n      onExcute: () => {\n        // 执行到此处逻辑 toast 才会显示\n        elements = createToastElAndShow(options);\n        if (typeof timeout === 'number' && timeout <= MAX_TIMEOUT) {\n          timer = setTimeout(queueResolve, timeout); // toast 执行结束\n        }\n        return queuePromise;\n      },\n    };\n\n    // 先存入队列\n    queueCtrl.push(queueItem);\n    queueCtrl.execute();\n\n    // 外部人为调用了 cancel\n    promise = promise.catch(error => {\n      // 但有两种情况\n      //  - 处于队列时就被取消了\n      //  - 弹出的过程中被取消\n\n      // 还在队列中，则提前移除\n      queueCtrl.remove(queueItem);\n\n      // 弹出过程中无需特殊处理\n      // ---\n\n      queueReject();\n\n      throw error;\n    });\n  } else {\n    elements = createToastElAndShow(options);\n    if (typeof timeout === 'number' && timeout <= MAX_TIMEOUT) {\n      timer = setTimeout(resolve, timeout);\n    }\n    promise = promise\n      .then(() => removeEl(elements.content, elements.container, options))\n      .catch(error => {\n        removeEl(elements.content, elements.container, options);\n        throw error;\n      });\n  }\n\n  return {\n    promise,\n    cancel: () => {\n      clearTimeout(timer);\n      reject(new Error(CANCELED_MSG));\n    },\n  };\n}\n\n/**\n * default enable `queue` toast\n * @since 1.2.0\n * @param opts\n * @param argTimeout\n */\nfunction queueToast(opts: IOptions, argTimeout?: number | true): IToastResult {\n  if (typeof opts === 'string') {\n    opts = { text: opts, queue: true };\n  } else if (typeof opts === 'boolean') {\n    opts = { loading: opts, queue: true };\n  } else if (opts && opts.queue !== void 0) {\n    opts.queue = true;\n  }\n  return toast(opts, argTimeout);\n}\n\nexport { toast, queueToast };\n","/*\n * @Author: daief\n * @LastEditors  : daief\n * @Date: 2019-08-15 16:04:14\n * @Description: 用于调试\n */\nimport toast, { queueToast } from '../src';\nimport '../src/style';\n\n// @ts-ignore\nwindow.axewToast = toast;\n// @ts-ignore\nwindow.axewToast.queueToast = queueToast;\n\nconst select = (_: string) => document.querySelector(_) as any;\n\nconst $toast: HTMLButtonElement = select('#toast');\nconst $cancel: HTMLButtonElement = select('#cancel');\nconst $queue: HTMLButtonElement = select('#queue');\n\nlet queue: any[] = [];\n\nconst getRadioValue = (name: string) => {\n  const value = select(`input[name=${name}]:checked`).value;\n  return value === 'true';\n};\n\nconst getInputValue = (name: string) => {\n  return (select(`input[name=${name}]`) || select(`textarea[name=${name}]`))\n    .value;\n};\n\n$toast.addEventListener('click', () => {\n  const text = getInputValue('text');\n  const loading = getRadioValue('loading');\n  let timeout = getInputValue('timeout');\n  timeout = timeout === 'true' ? true : +timeout || 0;\n  const isModal = getRadioValue('isModal');\n  const isQueue = getRadioValue('queue');\n  const className = getInputValue('className');\n  const onClick = getInputValue('onClick');\n\n  const { cancel, promise } = toast({\n    text,\n    loading,\n    timeout,\n    isModal,\n    className,\n    queue: isQueue,\n    onClick: () => {\n      try {\n        eval(onClick);\n      } catch (_) {\n        console.warn('Click event handler has some error', _);\n      }\n    },\n  });\n  promise.then(() => {\n    const i = queue.findIndex(_ => cancel);\n    if (i > -1) {\n      queue[i] = null;\n      queue = queue.filter(_ => !!_);\n    }\n  });\n  queue.push(cancel);\n});\n\n$cancel.addEventListener('click', () => {\n  const first = queue.shift();\n  if (first) {\n    first();\n  }\n});\n\n$queue.addEventListener('click', () => {\n  ['1st', '2nd', '3rd'].forEach(_ => {\n    const { cancel } = queueToast(_);\n    queue.push(cancel);\n  });\n});\n","/*\n * @Author: daief\n * @LastEditors: daief\n * @Date: 2019-08-15 15:56:08\n * @Description:\n */\nimport './index.less';\n"],"sourceRoot":""}